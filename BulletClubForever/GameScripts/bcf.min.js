
﻿LevelMap=function(x,y){this.map=[];this.x=x;this.y=y;};LevelMap.prototype.init=function(){for(var i=0;i<this.x;i++){this.map[i]=[];for(var j=0;j<this.y;j++){this.map[i][j]=".";}}
this.initPlatforms();this.overrideFirstPlatform();};LevelMap.prototype.initPlatforms=function(){for(var i=0;i<this.x;i++){this.makePieceOfMap(i);}};LevelMap.prototype.overrideFirstPlatform=function(){this.map[0][this.y-1]="G";};LevelMap.prototype.addNewPieceOfMap=function(){this.map[this.x]=[];this.makePieceOfMap(this.x);this.x++;};LevelMap.prototype.makePieceOfMap=function(xAxisPos){var hasGround=!createRandomBool(9);var groundPiece="."
if(hasGround){groundPiece="G";}
this.map[xAxisPos][this.y-1]=groundPiece;for(var i=0;i<this.y-1;i++){var hasPlatform=createRandomBool(20);if(i<2){hasPlatform=false;}
var newPiece=".";if(hasPlatform){newPiece="P";}
this.map[xAxisPos][i]=newPiece;}};function createRandom(n){return Math.floor((Math.random()*n)+1);}
function createRandomBool(n){var r=createRandom(n);return r===1;}﻿Player=function(game){this.game=game;this.MAXSPEED=150;this.ACCELLERATION=300;this.JUMPSPEED=400;this.GRAVITY=1200;this.playerSprite=null;this.feet=null;this.keyboard=null;this.cursorKeys=null;this.jumpWasReleaseSinceLastPressed=false;}
Player.prototype.preload=function(){this.game.load.image('player','Sprites/player.png');this.game.load.image('playerFeet','Sprites/player-feet.png');};Player.prototype.create=function(){this.feet=this.game.add.sprite(0,440,'playerFeet');this.playerSprite=this.game.add.sprite(-6,-22,'player');this.feet.addChild(this.playerSprite);this.game.physics.arcade.enable(this.feet);this.feet.body.collideWorldBounds=true;this.feet.body.gravity.y=this.GRAVITY;this.feet.body.maxVelocity.setTo(this.MAXSPEED,this.JUMPSPEED);this.keyboard=this.game.input.keyboard;this.cursorKeys=this.keyboard.createCursorKeys();};Player.prototype.update=function(platforms){var self=this;platforms.group.forEach(function(child){if(self.feet.body.y<child.body.y+self.feet.body.height){self.game.physics.arcade.collide(self.feet,child);}});if(this.cursorKeys.right.isDown){this.feet.body.acceleration.x=this.ACCELLERATION;}
else if(this.cursorKeys.left.isDown){this.feet.body.acceleration.x=-this.ACCELLERATION;}
else{this.feet.body.acceleration.x=0;this.feet.body.velocity.x=0;}
var onPlatform=this.feet.body.touching.down;if(onPlatform&&this.jumpWasReleaseSinceLastPressed){if(this.keyboard.isDown(Phaser.Keyboard.X)){this.feet.body.velocity.y=-this.JUMPSPEED;this.jumpWasReleaseSinceLastPressed=false;}}
if(!this.keyboard.isDown(Phaser.Keyboard.X)){this.jumpWasReleaseSinceLastPressed=true;}};﻿Platforms=function(game,levelMap){this.game=game;this.levelMap=levelMap;this.group=null;};Platforms.prototype.preload=function(){this.game.load.image('platform','Sprites/platform.png');};Platforms.prototype.create=function(){this.group=this.game.add.group();this.group.enableBody=true;for(var i=0;i<this.levelMap.y;i++){for(var j=0;j<this.levelMap.x;j++){var currentTile=this.levelMap.map[j][i];if(currentTile==="P"||currentTile==="G"){var newPlatform=this.group.create(j*spriteWidth,i*spriteHeight,'platform');newPlatform.body.immovable=true;}}}};Platforms.prototype.update=function(){};﻿var spriteWidth=25;var spriteHeight=25;var game=new Phaser.Game(800,500,Phaser.AUTO,'game',{preload:preload,create:create,update:update});var levelMap=new LevelMap(100,20);var platforms=new Platforms(game,levelMap);var player=new Player(game);function preload(){platforms.preload();player.preload();}
function create(){game.stage.backgroundColor="#66CCFF";game.physics.startSystem(Phaser.Physics.ARCADE);levelMap.init();platforms.create();player.create();}
function update(){player.update(platforms);}