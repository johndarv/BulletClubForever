
﻿LevelMap=function(x,y){this.map=[];this.x=x;this.y=y;};LevelMap.prototype.init=function(){for(var i=0;i<this.x;i++){this.map[i]=[];for(var j=0;j<this.y;j++){this.map[i][j]=".";}}
this.initPlatforms();this.overrideFirstPlatform();};LevelMap.prototype.initPlatforms=function(){for(var i=0;i<this.x;i++){this.makePieceOfMap(i);}};LevelMap.prototype.overrideFirstPlatform=function(){this.map[0][this.y-1]="G";};LevelMap.prototype.addNewPieceOfMap=function(){this.map[this.x]=[];this.makePieceOfMap(this.x);this.x++;};LevelMap.prototype.makePieceOfMap=function(xAxisPos){var hasGround=!createRandomBool(9);var groundPiece="."
if(hasGround){groundPiece="G";}
this.map[xAxisPos][this.y-1]=groundPiece;for(var i=0;i<this.y-1;i++){var hasPlatform=createRandomBool(20);if(i<2){hasPlatform=false;}
var newPiece=".";if(hasPlatform){newPiece="P";}
this.map[xAxisPos][i]=newPiece;}};function createRandom(n){return Math.floor((Math.random()*n)+1);}
function createRandomBool(n){var r=createRandom(n);return r===1;}﻿Player=function(game){this.game=game;this.MAXSPEED=150;this.ACCELLERATION=300;this.JUMPSPEED=400;this.GRAVITY=1200;this.playerSprite=null;this.keyboard=null;this.cursorKeys=null;this.jumpWasReleaseSinceLastPressed=false;this.totalDistance=0;};Player.prototype.preload=function(){this.game.load.image('player','Sprites/player.png');};Player.prototype.create=function(){this.playerSprite=this.game.add.sprite(0,445,'player');this.game.physics.arcade.enable(this.playerSprite);this.playerSprite.body.collideWorldBounds=true;this.playerSprite.body.setSize(12,25,6,0);this.playerSprite.body.gravity.y=this.GRAVITY;this.playerSprite.body.maxVelocity.setTo(this.MAXSPEED,this.JUMPSPEED);this.keyboard=this.game.input.keyboard;this.cursorKeys=this.keyboard.createCursorKeys();};Player.prototype.update=function(platforms){var self=this;self.game.physics.arcade.collide(self.playerSprite,platforms.group);if(this.cursorKeys.right.isDown){this.playerSprite.body.acceleration.x=this.ACCELLERATION;}
else if(this.cursorKeys.left.isDown){this.playerSprite.body.acceleration.x=-this.ACCELLERATION;}
else{this.playerSprite.body.acceleration.x=0;this.playerSprite.body.velocity.x=0;}
var onPlatform=this.playerSprite.body.touching.down;if(onPlatform&&this.jumpWasReleaseSinceLastPressed){if(this.keyboard.isDown(Phaser.Keyboard.X)){this.playerSprite.body.velocity.y=-this.JUMPSPEED;this.jumpWasReleaseSinceLastPressed=false;}}
if(!this.keyboard.isDown(Phaser.Keyboard.X)){this.jumpWasReleaseSinceLastPressed=true;}
this.totalDistance+=this.playerSprite.body.deltaX();};Player.prototype.render=function(){this.game.debug.bodyInfo(this.playerSprite,32,32);this.game.debug.body(this.playerSprite);this.game.debug.text('Total Distance: '+this.totalDistance.toString(),32,136);};﻿Platforms=function(game,levelMap){this.game=game;this.levelMap=levelMap;this.group=null;this.scrollingTracker=0;};Platforms.prototype.preload=function(){this.game.load.image('platform','Sprites/platform.png');};Platforms.prototype.create=function(){this.group=this.game.add.group();this.group.enableBody=true;for(var i=0;i<this.levelMap.y;i++){for(var j=0;j<this.levelMap.x;j++){var currentTile=this.levelMap.map[j][i];if(currentTile==="P"||currentTile==="G"){var newPlatform=this.group.create(j*spriteWidth,i*spriteHeight,'platform');newPlatform.body.immovable=true;newPlatform.body.checkCollision={up:true,down:false,left:false,right:false};}}}};Platforms.prototype.update=function(){if(this.scrollingTracker>25){this.group.forEach(function(platform){if(platform.world.x<=-25){platform.kill();}});this.scrollingTracker-=25;}};﻿var spriteWidth=25;var spriteHeight=25;var maxXValueForPlayer=300;var game=new Phaser.Game(800,500,Phaser.AUTO,'game',{preload:preload,create:create,update:update,render:render});var levelMap=new LevelMap(40,20);var platforms=new Platforms(game,levelMap);var player=new Player(game);var activeObjects;function preload(){platforms.preload();player.preload();}
function create(){game.stage.backgroundColor="#66CCFF";game.physics.startSystem(Phaser.Physics.ARCADE);activeObjects=game.add.group();levelMap.init();platforms.create(activeObjects);player.create(activeObjects);}
function update(){player.update(platforms);platforms.update();doScrolling();}
function render(){player.render();}
function doScrolling(){var distanceToScroll=maxXValueForPlayer-player.playerSprite.body.x;if(distanceToScroll<0){this.player.playerSprite.body.x+=distanceToScroll;this.platforms.group.x+=distanceToScroll;this.platforms.scrollingTracker+=-distanceToScroll;}}